<ion-header>
  <ion-toolbar>
    <ion-title>Profile</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        <ion-icon slot="start" name="log-out-outline"></ion-icon>
        Logout
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="loadMe($event)">
    <ion-refresher-content pullingIcon="chevron-down-circle-outline">
    </ion-refresher-content>
  </ion-refresher>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
    <p class="loading-text">Loading profile...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <div class="error-icon">
      <ion-icon name="warning-outline"></ion-icon>
    </div>
    <h3 class="error-title">Something went wrong</h3>
    <p class="error-message">{{ error }}</p>
    <ion-button class="retry-button" (click)="loadMe()">
      Try Again
    </ion-button>
  </div>

  <!-- Profile Content -->
  <div *ngIf="user && !loading && !error">
    <!-- Background Wave -->
    <div class="profile-background">
      <div class="wave"></div>
    </div>

    <!-- Profile Header -->
    <div class="profile-header">
      <div class="profile-avatar">
        <ion-icon name="person-circle-outline"></ion-icon>
        <div class="status-indicator"></div>
      </div>
      
      <div class="profile-info">
        <h1 class="profile-name">{{ user.fullName }}</h1>
        <p class="profile-email">{{ user.email }}</p>
      </div>
    </div>

    <!-- Stats Section -->
    <div class="stats-section">
      <h3 class="stats-title">
        <ion-icon name="stats-chart-outline"></ion-icon>
        Library Activity
      </h3>
      
      <div class="stats-grid">
        <div class="stat-card membership">
          <div class="stat-icon">
            <ion-icon name="calendar-outline"></ion-icon>
          </div>
          <h2 class="stat-value">{{ user.membershipDate | date:'yyyy' }}</h2>
          <p class="stat-label">Member Since</p>
          <p class="stat-detail">{{ user.membershipDate | date:'MMM d' }}</p>
        </div>
        
        <div class="stat-card loans">
          <div class="stat-icon">
            <ion-icon name="book-outline"></ion-icon>
          </div>
          <h2 class="stat-value">{{ user.loanCount }}</h2>
          <p class="stat-label">Active Loans</p>
          <p class="stat-detail">{{ user.loanCount === 1 ? 'Book' : 'Books' }}</p>
        </div>
      </div>
    </div>

    <!-- User Info Section -->
    <div class="info-section">
      <h3 class="info-title">
        <ion-icon name="information-circle-outline"></ion-icon>
        Account Details
      </h3>
      
      <div class="info-card">
        <ion-item class="info-item" lines="none">
          <ion-label slot="start">Full Name</ion-label>
          <ion-text slot="end">{{ user.fullName }}</ion-text>
        </ion-item>
        
        <ion-item class="info-item" lines="none">
          <ion-label slot="start">Email Address</ion-label>
          <ion-text slot="end">{{ user.email }}</ion-text>
        </ion-item>
        
        <ion-item class="info-item" lines="none">
          <ion-label slot="start">Membership</ion-label>
          <ion-text slot="end">{{ user.membershipDate | date:'longDate' }}</ion-text>
        </ion-item>
        
        <ion-item class="info-item" lines="none">
          <ion-label slot="start">Account Type</ion-label>
          <ion-text slot="end">Library Member</ion-text>
        </ion-item>
      </div>
    </div>
  </div>
</ion-content>